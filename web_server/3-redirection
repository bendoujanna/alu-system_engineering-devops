#!/usr/bin/env bash
#step 1: Update and install Nginx
apt-get update -y
apt-get install -y nginx

# Step 2: Replace default index page
echo "Holberton School" > /var/www/html/index.html

# Step 3: Start or restart Nginx (like in 1-install_nginx_web_server)
service nginx start || service nginx restart

# Step 4: Add /redirect_me block
NGINX_CONF="/etc/nginx/sites-available/default"

# Backup if not exists
[ ! -f "${NGINX_CONF}.bak" ] && cp "$NGINX_CONF" "${NGINX_CONF}.bak"

# Remove old /redirect_me if any
sed -i "/location \/redirect_me/,/}/d" "$NGINX_CONF"

# Add new redirect
awk '
/server\s*{/ {
    print
    print "    location = /redirect_me { return 301 https://www.youtube.com/watch?v=QH2-TGUlwu4; }"
    next
}
{print}
' "$NGINX_CONF" > "${NGINX_CONF}.tmp" && mv "${NGINX_CONF}.tmp" "$NGINX_CONF"

# Test config and restart Nginx
nginx -t
service nginx restart
